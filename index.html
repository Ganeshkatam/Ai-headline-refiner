<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TomeSphere - Digital Tools for Indian Business</title>
    <meta name="description" content="Free Local SEO tools and premium digital assets for Indian businesses.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .brand-gradient {
            background: linear-gradient(to right, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0; }
        .btn-primary {
            background: linear-gradient(to right, #2563eb, #6366f1);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
        }
        .dashboard-nav-item.active {
            background-color: #eff6ff;
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }
        /* Modal Animation */
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow: hidden; }
        
        /* Smooth fade for views */
        .view-section { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-100 py-3 px-6 sticky top-0 z-50 shadow-sm">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-6">
                <div class="text-2xl font-bold tracking-tight cursor-pointer" onclick="switchView('home')">
                    <span class="brand-gradient">TomeSphere</span><span class="text-blue-600">.in</span>
                </div>
                <!-- Desktop Nav Links -->
                <div class="hidden md:flex space-x-4 text-sm font-medium text-slate-600">
                    <button onclick="switchView('home')" class="hover:text-blue-600 transition">Tools</button>
                    <button onclick="switchView('home', 'shop-section')" class="hover:text-blue-600 transition">Asset Store</button>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <div id="auth-container">
                    <!-- State 1: Login Button -->
                    <button id="login-btn" onclick="toggleModal('login-modal')" class="text-sm font-bold text-slate-700 hover:text-blue-600 transition flex items-center bg-gray-50 px-4 py-2 rounded-lg border border-gray-200">
                        Login / Sign Up
                    </button>
                    
                    <!-- State 2: User Profile Dropdown Area -->
                    <div id="user-profile" class="hidden flex items-center space-x-3">
                        <button onclick="switchView('dashboard')" class="bg-blue-50 text-blue-700 text-xs font-bold px-3 py-1.5 rounded-full hover:bg-blue-100 transition">
                            Dashboard
                        </button>
                        <div class="h-9 w-9 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-md cursor-pointer relative group" id="user-avatar">
                            U
                            <!-- Simple Dropdown -->
                            <div class="absolute right-0 top-10 w-48 bg-white rounded-xl shadow-xl border border-gray-100 hidden group-hover:block p-2 z-50">
                                <div class="px-4 py-2 border-b border-gray-100">
                                    <p id="dropdown-name" class="text-sm font-bold text-gray-800">User</p>
                                    <p id="nav-user-plan" class="text-xs text-gray-400">Free Plan</p>
                                </div>
                                <button onclick="switchView('dashboard')" class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-lg">My Dashboard</button>
                                <button onclick="logout()" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 rounded-lg">Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-grow bg-slate-50">
        
        <!-- VIEW 1: HOME (Landing Page) -->
        <div id="view-home" class="view-section">
            <!-- Hero -->
            <div class="bg-white pb-12 pt-10 px-4 mb-8">
                <div class="max-w-3xl mx-auto text-center">
                    <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-slate-900 leading-tight">
                        Grow Your Local Business
                    </h1>
                    <p class="text-lg text-gray-500 mb-8">Free AI writing tools & premium design assets for the modern Indian entrepreneur.</p>
                    <div class="flex justify-center space-x-4">
                        <a href="#ai-tool" class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transition transform hover:-translate-y-1">Use Free AI Tool</a>
                        <a href="#shop-section" class="bg-white text-slate-800 border border-gray-200 font-semibold py-3 px-8 rounded-full hover:bg-gray-50 transition">Shop Assets</a>
                    </div>
                </div>
            </div>

            <div class="max-w-4xl mx-auto p-4 space-y-16">
                <!-- TOOL SECTION -->
                <section id="ai-tool" class="scroll-mt-24">
                    <div class="card p-6 md:p-8 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-500"></div>
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">Local SEO & Caption Generator</h2>
                            <span class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full">FREE</span>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Business Name</label>
                                <input type="text" id="biz-name" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="e.g., Sharma Sweets">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">City / Location</label>
                                <input type="text" id="biz-city" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="e.g., Dadar, Mumbai">
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Key Services / Products</label>
                            <input type="text" id="biz-service" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="e.g., Best Kaju Katli, Samosas, Diwali Gift Packs">
                        </div>

                        <button id="generate-btn" onclick="generateSEO()" class="w-full btn-primary text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-2">
                            <span>‚ú® Generate Optimized Content</span>
                        </button>

                        <!-- Output Area -->
                        <div id="output-area" class="hidden mt-8 space-y-6 animate-fade-in">
                            <div class="bg-slate-50 p-5 rounded-xl border border-slate-200 relative group">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-bold text-slate-800 flex items-center">üìç Google Business Profile</h3>
                                    <button onclick="copyToClipboard('output-gmb')" class="text-xs bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50">Copy</button>
                                </div>
                                <p id="output-gmb" class="text-sm text-slate-600 whitespace-pre-wrap leading-relaxed"></p>
                            </div>
                            
                            <div class="bg-slate-50 p-5 rounded-xl border border-slate-200">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-bold text-slate-800 flex items-center">üì± Viral Status Update</h3>
                                    <button onclick="copyToClipboard('output-social')" class="text-xs bg-white border border-gray-200 px-2 py-1 rounded hover:bg-gray-50">Copy</button>
                                </div>
                                <p id="output-social" class="text-sm text-slate-600 whitespace-pre-wrap leading-relaxed"></p>
                            </div>
                            
                            <div class="bg-indigo-50 border border-indigo-100 p-5 rounded-xl flex flex-col md:flex-row items-center justify-between gap-4">
                                <div>
                                    <p class="font-bold text-indigo-900">üöÄ Save this result?</p>
                                    <p class="text-xs text-indigo-700">Login to your dashboard to save history automatically.</p>
                                </div>
                                <button onclick="toggleModal('login-modal')" class="text-indigo-600 text-sm font-bold underline">Login Now</button>
                            </div>
                        </div>

                        <!-- Loading Spinner -->
                        <div id="loading" class="hidden mt-8 text-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"></div>
                            <p class="text-sm font-medium text-gray-500">Writing magic copy...</p>
                        </div>
                    </div>
                </section>

                <!-- SHOP SECTION -->
                <section id="shop-section" class="pb-12">
                    <div class="flex items-center space-x-2 mb-6">
                        <h2 class="text-2xl font-bold text-slate-800">Premium Image Packs</h2>
                        <span class="bg-purple-100 text-purple-700 text-xs font-bold px-2 py-1 rounded">STORE</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Product 1 -->
                        <div class="card overflow-hidden group hover:shadow-xl transition-all">
                            <div class="h-48 bg-slate-200 flex flex-col items-center justify-center text-slate-400 font-bold relative">
                                <span class="text-4xl mb-2">üè¢</span>
                                <span>Indian Office Pack</span>
                            </div>
                            <div class="p-6">
                                <h3 class="font-bold text-xl text-slate-900 mb-1">Corporate India</h3>
                                <p class="text-sm text-slate-500 mb-4"> 20+ High-Res AI images of realistic Indian office settings. Perfect for LinkedIn.</p>
                                <div class="flex items-center justify-between border-t border-gray-100 pt-4">
                                    <span class="text-2xl font-bold text-slate-900">‚Çπ129</span>
                                    <a href="https://katamganesh.gumroad.com/l/ivkov" class="bg-slate-900 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-slate-800 transition">Buy Pack</a>
                                </div>
                            </div>
                        </div>
                        <!-- Product 2 -->
                        <div class="card overflow-hidden group hover:shadow-xl transition-all">
                            <div class="h-48 bg-orange-100 flex flex-col items-center justify-center text-orange-400 font-bold relative">
                                <span class="text-4xl mb-2">ü™î</span>
                                <span>Festival Pack</span>
                            </div>
                            <div class="p-6">
                                <h3 class="font-bold text-xl text-slate-900 mb-1">Festival Marketing</h3>
                                <p class="text-sm text-slate-500 mb-4">50+ Stunning backgrounds for Diwali, Holi, and Dussehra sales posts.</p>
                                <div class="flex items-center justify-between border-t border-gray-100 pt-4">
                                    <span class="text-2xl font-bold text-slate-900">‚Çπ179</span>
                                    <a href="https://katamganesh.gumroad.com/l/dwxyn" class="bg-slate-900 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-slate-800 transition">Buy Pack</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- VIEW 2: DASHBOARD (Hidden by default) -->
        <div id="view-dashboard" class="hidden view-section min-h-screen">
            <div class="max-w-6xl mx-auto p-4 md:p-8 flex flex-col md:flex-row gap-8">
                
                <!-- Dashboard Sidebar -->
                <aside class="w-full md:w-64 flex-shrink-0">
                    <div class="card p-6 sticky top-24">
                        <div class="text-center mb-6">
                            <div class="h-16 w-16 mx-auto rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold shadow-md mb-3" id="dash-avatar">U</div>
                            <h2 id="dash-name" class="font-bold text-lg text-slate-800">User Name</h2>
                            <p id="dash-email" class="text-xs text-slate-500">user@example.com</p>
                            <!-- UPDATED: Dynamic Plan Status -->
                            <span id="dash-user-plan" class="inline-block mt-2 bg-green-100 text-green-700 text-[10px] font-bold px-2 py-0.5 rounded-full">FREE MEMBER</span>
                        </div>
                        
                        <nav class="space-y-1">
                            <button onclick="switchDashTab('tab-overview')" id="nav-tab-overview" class="dashboard-nav-item active w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition flex items-center gap-3">
                                <span>üìä</span> Overview
                            </button>
                            <button onclick="switchDashTab('tab-history')" id="nav-tab-history" class="dashboard-nav-item w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition flex items-center gap-3">
                                <span>üïí</span> History <span id="history-count" class="ml-auto bg-gray-200 text-gray-600 text-[10px] px-1.5 rounded-full">0</span>
                            </button>
                            <button onclick="switchDashTab('tab-assets')" id="nav-tab-assets" class="dashboard-nav-item w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition flex items-center gap-3">
                                <span>üì¶</span> My Assets
                            </button>
                            <button onclick="switchDashTab('tab-settings')" id="nav-tab-settings" class="dashboard-nav-item w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition flex items-center gap-3">
                                <span>‚öôÔ∏è</span> Profile Setup
                            </button>
                        </nav>
                    </div>
                </aside>

                <!-- Dashboard Content Area -->
                <div class="flex-grow">
                    
                    <!-- TAB: OVERVIEW -->
                    <div id="tab-overview" class="dash-tab block space-y-6">
                        <div class="card p-8 bg-gradient-to-r from-blue-600 to-indigo-700 text-white border-none">
                            <h2 class="text-2xl font-bold mb-2">Welcome back, <span id="welcome-name">User</span>! üëã</h2>
                            <p class="text-blue-100 text-sm">You are viewing your TomeSphere dashboard.</p>
                            <div class="mt-6 flex gap-4">
                                <button onclick="switchView('home')" class="bg-white text-blue-700 px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-blue-50">Create New Content</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="card p-6">
                                <p class="text-xs font-bold text-gray-400 uppercase">Total Generations</p>
                                <p id="stat-gens" class="text-3xl font-bold text-slate-800 mt-1">0</p>
                            </div>
                            <div class="card p-6">
                                <p class="text-xs font-bold text-gray-400 uppercase">Assets Owned</p>
                                <p class="text-3xl font-bold text-slate-800 mt-1">0</p>
                            </div>
                            <div class="card p-6">
                                <p class="text-xs font-bold text-gray-400 uppercase">Plan Status</p>
                                <!-- UPDATED: Dynamic Overview Status -->
                                <p id="stat-plan" class="text-xl font-bold text-green-600 mt-1">Free</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: HISTORY -->
                    <div id="tab-history" class="dash-tab hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-slate-800">Generation History</h2>
                            <button onclick="clearHistory()" class="text-xs text-red-500 hover:underline">Clear History</button>
                        </div>
                        <div id="history-list" class="space-y-4">
                            <!-- JS will populate this -->
                            <div class="text-center py-12 text-gray-400 card">
                                <p>No history yet. Generate some content!</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: ASSETS -->
                    <div id="tab-assets" class="dash-tab hidden">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">My Purchased Assets</h2>
                        <div class="card p-12 text-center">
                            <div class="bg-gray-100 h-16 w-16 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">üì¶</div>
                            <h3 class="font-bold text-lg text-gray-800">No Assets Found</h3>
                            <p class="text-gray-500 text-sm mb-6">You haven't purchased any premium image packs yet.</p>
                            <button onclick="switchView('home', 'shop-section')" class="bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-blue-700">Browse Store</button>
                        </div>
                    </div>

                    <!-- TAB: SETTINGS -->
                    <div id="tab-settings" class="dash-tab hidden">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">Profile Setup</h2>
                        <div class="card p-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Display Name</label>
                                    <input type="text" id="set-name" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Email Address</label>
                                    <input type="text" id="set-email" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Business Name</label>
                                    <input type="text" id="set-company" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Role</label>
                                    <select id="set-role" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                        <option>Founder / Owner</option>
                                        <option>Marketing Manager</option>
                                        <option>Freelancer</option>
                                        <option>Student</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <button onclick="saveProfile()" class="bg-blue-600 text-white px-6 py-3 rounded-lg text-sm font-bold hover:bg-blue-700 transition">Save Changes</button>
                                <!-- NEW BUTTON: Toggle Premium -->
                                <button onclick="togglePremium()" class="bg-purple-100 text-purple-700 px-6 py-3 rounded-lg text-sm font-bold hover:bg-purple-200 transition">Simulate Upgrade to Premium</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-100 py-8 text-center text-sm text-gray-400">
        <p class="font-bold text-slate-800">TomeSphere.in</p>
        <p class="mt-1">¬© 2025. Empowering Indian Entrepreneurs.</p>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[60]">
        <div class="modal-overlay absolute w-full h-full bg-slate-900 opacity-60 backdrop-blur-sm" onclick="toggleModal('login-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded-xl shadow-2xl z-50 overflow-hidden transform scale-95 transition-transform duration-300">
            <div class="p-8 text-center">
                <div class="h-12 w-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" /></svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Welcome to TomeSphere</h3>
                <p class="text-gray-500 text-sm mb-6">Login to save your content history and manage your business profile.</p>
                
                <div class="space-y-3">
                    <button onclick="loginUser('Google User')" class="w-full border border-gray-300 p-3 rounded-lg flex items-center justify-center space-x-2 hover:bg-gray-50 font-medium text-gray-700 transition">
                        <span>Continue with Google</span>
                    </button>
                    <div class="relative py-2">
                        <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200"></div></div>
                        <div class="relative flex justify-center text-xs uppercase"><span class="bg-white px-2 text-gray-500">Or enter details</span></div>
                    </div>
                    <input type="text" id="login-email" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your Name or Email">
                    <button onclick="loginUser(document.getElementById('login-email').value)" class="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition">Start Dashboard</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // API Configuration
        const apiKey = "AIzaSyBhXSb0jlucI1WccUlwwe2CEqsx3t7HK5E"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- STATE MANAGEMENT ---
        let currentUser = null;
        let historyData = [];

        // On Load
        document.addEventListener('DOMContentLoaded', () => {
            loadUser();
            renderHistory();
        });

        // --- AUTHENTICATION & PROFILE ---
        
        window.toggleModal = function(modalID) {
            const modal = document.getElementById(modalID);
            const container = modal.querySelector('.modal-container');
            modal.classList.toggle('opacity-0');
            modal.classList.toggle('pointer-events-none');
            document.body.classList.toggle('modal-active');
            
            if (!modal.classList.contains('opacity-0')) {
                container.classList.remove('scale-95');
                container.classList.add('scale-100');
            } else {
                container.classList.remove('scale-100');
                container.classList.add('scale-95');
            }
        }

        window.loginUser = function(identifier) {
            if(!identifier) identifier = "Guest User";
            let name = identifier.includes('@') ? identifier.split('@')[0] : identifier;
            name = name.charAt(0).toUpperCase() + name.slice(1);

            const userData = {
                name: name,
                email: identifier.includes('@') ? identifier : '',
                company: '',
                role: 'Founder',
                joined: new Date().toLocaleDateString(),
                plan: 'Free' // Default Plan
            };

            localStorage.setItem('tomesphere_user', JSON.stringify(userData));
            loadUser();
            toggleModal('login-modal');
            switchView('dashboard'); // Auto redirect to dash
        }

        window.logout = function() {
            localStorage.removeItem('tomesphere_user');
            localStorage.removeItem('tomesphere_history'); // Optional: Clear history on logout? keeping it simple
            currentUser = null;
            historyData = [];
            
            document.getElementById('auth-container').innerHTML = `
                <button id="login-btn" onclick="toggleModal('login-modal')" class="text-sm font-bold text-slate-700 hover:text-blue-600 transition flex items-center bg-gray-50 px-4 py-2 rounded-lg border border-gray-200">
                    Login / Sign Up
                </button>
            `;
            
            switchView('home');
        }

        function loadUser() {
            const stored = localStorage.getItem('tomesphere_user');
            if (stored) {
                currentUser = JSON.parse(stored);
                // Ensure plan exists for old users
                if(!currentUser.plan) currentUser.plan = 'Free';
                
                // Update Navbar State
                document.getElementById('auth-container').innerHTML = `
                    <div id="user-profile" class="flex items-center space-x-3">
                        <button onclick="switchView('dashboard')" class="bg-blue-50 text-blue-700 text-xs font-bold px-3 py-1.5 rounded-full hover:bg-blue-100 transition">Dashboard</button>
                        <div class="h-9 w-9 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-md cursor-pointer relative group">
                            ${currentUser.name.charAt(0)}
                            <div class="absolute right-0 top-10 w-48 bg-white rounded-xl shadow-xl border border-gray-100 hidden group-hover:block p-2 z-50">
                                <div class="px-4 py-2 border-b border-gray-100">
                                    <p class="text-sm font-bold text-gray-800 truncate">${currentUser.name}</p>
                                    <p id="nav-user-plan" class="text-xs text-gray-400">${currentUser.plan} Plan</p>
                                </div>
                                <button onclick="switchView('dashboard')" class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-lg">My Dashboard</button>
                                <button onclick="logout()" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 rounded-lg">Logout</button>
                            </div>
                        </div>
                    </div>
                `;

                // Populate Dashboard Fields
                document.getElementById('dash-name').innerText = currentUser.name;
                document.getElementById('welcome-name').innerText = currentUser.name;
                document.getElementById('dash-email').innerText = currentUser.email || 'No email set';
                document.getElementById('dash-avatar').innerText = currentUser.name.charAt(0);
                
                document.getElementById('set-name').value = currentUser.name;
                document.getElementById('set-email').value = currentUser.email;
                document.getElementById('set-company').value = currentUser.company;
                document.getElementById('set-role').value = currentUser.role;

                // Update Plan UI
                updatePlanUI(currentUser.plan);

                // Load History
                const storedHistory = localStorage.getItem('tomesphere_history');
                if(storedHistory) historyData = JSON.parse(storedHistory);
                renderHistory();
            }
        }

        // NEW: Function to handle Plan UI updates
        function updatePlanUI(plan) {
            const isPremium = plan === 'Premium';
            
            // Navbar
            const navPlan = document.getElementById('nav-user-plan');
            if(navPlan) {
                navPlan.innerText = plan + ' Plan';
                navPlan.className = isPremium ? "text-xs text-purple-600 font-bold" : "text-xs text-gray-400";
            }

            // Dashboard Sidebar Badge
            const dashPlan = document.getElementById('dash-user-plan');
            if(dashPlan) {
                dashPlan.innerText = isPremium ? "PREMIUM MEMBER" : "FREE MEMBER";
                dashPlan.className = isPremium 
                    ? "inline-block mt-2 bg-purple-100 text-purple-700 text-[10px] font-bold px-2 py-0.5 rounded-full"
                    : "inline-block mt-2 bg-green-100 text-green-700 text-[10px] font-bold px-2 py-0.5 rounded-full";
            }

            // Overview Card
            const statPlan = document.getElementById('stat-plan');
            if(statPlan) {
                statPlan.innerText = plan;
                statPlan.className = isPremium ? "text-xl font-bold text-purple-600 mt-1" : "text-xl font-bold text-green-600 mt-1";
            }
        }

        // NEW: Toggle Premium for simulation
        window.togglePremium = function() {
            if(!currentUser) return;
            // Toggle
            currentUser.plan = currentUser.plan === 'Free' ? 'Premium' : 'Free';
            localStorage.setItem('tomesphere_user', JSON.stringify(currentUser));
            
            loadUser(); // Refresh UI
            alert("Membership upgraded to " + currentUser.plan + " (Simulation)");
        }

        window.saveProfile = function() {
            if(!currentUser) return;
            currentUser.name = document.getElementById('set-name').value;
            currentUser.email = document.getElementById('set-email').value;
            currentUser.company = document.getElementById('set-company').value;
            currentUser.role = document.getElementById('set-role').value;
            
            localStorage.setItem('tomesphere_user', JSON.stringify(currentUser));
            alert("Profile Saved!");
            loadUser(); // Refresh UI
        }

        // --- NAVIGATION LOGIC ---

        window.switchView = function(viewId, scrollTargetId = null) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            // Show target
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            // Auto scroll to specific section if requested
            if(scrollTargetId) {
                setTimeout(() => {
                    const el = document.getElementById(scrollTargetId);
                    if(el) el.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } else {
                window.scrollTo(0,0);
            }
        }

        window.switchDashTab = function(tabId) {
            // Reset nav styles
            document.querySelectorAll('.dashboard-nav-item').forEach(el => {
                el.classList.remove('active', 'bg-blue-50', 'text-blue-600', 'border-r-4', 'border-blue-600');
                el.classList.add('text-slate-600');
            });
            // Set active nav
            const btn = document.getElementById(`nav-${tabId}`);
            btn.classList.add('active');

            // Toggle Tab Content
            document.querySelectorAll('.dash-tab').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
        }

        // --- HISTORY LOGIC ---

        function addToHistory(gmb, social, businessName) {
            const entry = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                biz: businessName,
                gmb: gmb,
                social: social
            };
            historyData.unshift(entry); // Add to start
            localStorage.setItem('tomesphere_history', JSON.stringify(historyData));
            renderHistory();
        }

        function renderHistory() {
            document.getElementById('stat-gens').innerText = historyData.length;
            document.getElementById('history-count').innerText = historyData.length;
            
            const list = document.getElementById('history-list');
            if(historyData.length === 0) {
                list.innerHTML = `<div class="text-center py-12 text-gray-400 card border-dashed"><p>No history yet.</p></div>`;
                return;
            }

            list.innerHTML = historyData.map(item => `
                <div class="card p-5 border border-gray-100 hover:border-blue-200 transition">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold text-slate-800">${item.biz}</h4>
                            <span class="text-xs text-gray-400">${item.date}</span>
                        </div>
                        <button onclick="deleteHistoryItem(${item.id})" class="text-xs text-red-400 hover:text-red-600">Delete</button>
                    </div>
                    <div class="bg-gray-50 p-3 rounded text-xs text-gray-600 truncate mb-2">${item.gmb.substring(0, 80)}...</div>
                    <div class="flex gap-2">
                        <button onclick="copyText('${item.gmb.replace(/'/g, "\\'")}')" class="text-xs bg-white border px-2 py-1 rounded hover:bg-blue-50 text-blue-600">Copy GMB</button>
                        <button onclick="copyText('${item.social.replace(/'/g, "\\'")}')" class="text-xs bg-white border px-2 py-1 rounded hover:bg-blue-50 text-blue-600">Copy Social</button>
                    </div>
                </div>
            `).join('');
        }
        
        window.deleteHistoryItem = function(id) {
            historyData = historyData.filter(item => item.id !== id);
            localStorage.setItem('tomesphere_history', JSON.stringify(historyData));
            renderHistory();
        }

        window.clearHistory = function() {
            if(confirm("Clear all history?")) {
                historyData = [];
                localStorage.removeItem('tomesphere_history');
                renderHistory();
            }
        }
        
        window.copyText = function(text) {
            navigator.clipboard.writeText(text);
            alert("Copied!");
        }
        window.copyToClipboard = function(elementId) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => { alert("Copied to clipboard!"); });
        }

        // --- AI GENERATION ---

        window.generateSEO = async function() {
            const name = document.getElementById('biz-name').value;
            const city = document.getElementById('biz-city').value;
            const service = document.getElementById('biz-service').value;
            
            if(!name || !city) {
                alert("Please enter at least your Business Name and City.");
                return;
            }

            // UI Loading State
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('output-area').classList.add('hidden');
            document.getElementById('generate-btn').disabled = true;
            document.getElementById('generate-btn').innerHTML = `<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>`;

            const systemPrompt = `Act as an expert Digital Marketer for Indian Small Businesses.
            User Input: Business Name: ${name}, City: ${city}, Services: ${service}.
            
            Task 1: Write a Google Business Profile Description (max 700 chars).
            - Use high-traffic local keywords for ${city}.
            - Mention nearby landmarks or generic location markers.
            - Tone: Trustworthy, Established, Warm.
            - Include a clear service list.
            
            Task 2: Write a Viral Instagram/WhatsApp Status (max 50 words).
            - Use a mix of English and Hindi (Hinglish).
            - Use 3-4 relevant emojis.
            - Call to Action.
            
            Output format: JSON object with keys "gmb" and "social".`;

            const payload = {
                contents: [{ parts: [{ text: systemPrompt }] }],
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const content = JSON.parse(result.candidates[0].content.parts[0].text);
                
                document.getElementById('output-gmb').textContent = content.gmb;
                document.getElementById('output-social').textContent = content.social;
                
                // Show Result
                document.getElementById('output-area').classList.remove('hidden');
                
                // Save to History (if logged in, or purely local)
                addToHistory(content.gmb, content.social, name);

            } catch (error) {
                console.error(error);
                alert("Error generating content. Please check connection.");
            }

            // Reset UI
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('generate-btn').disabled = false;
            document.getElementById('generate-btn').innerText = "‚ú® Generate Optimized Content";
        }
    </script>
</body>
</html>



